(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[307],{1913:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>o});var t=a(6814),d=a(2094),s=a(217),l=a(6271),n=a(324),i=a(6979);function c(){let[e,r]=(0,d.useState)(!0),[a,c]=(0,d.useState)(null),[o,g]=(0,d.useState)(null),[x,h]=(0,d.useState)(null),b=(0,l.kk)(()=>s.db.receipts.orderBy("createdAt").reverse().limit(5).toArray(),[],[]),u=(0,d.useCallback)(e=>{try{let r=Object.fromEntries(new URLSearchParams(e));if(!["t","s","fn","i","fp","n"].every(e=>r.hasOwnProperty(e)))return null;return{t:r.t||"",s:r.s||"",fn:r.fn||"",i:r.i||"",fp:r.fp||"",n:r.n||""}}catch(e){return null}},[]),m=(0,d.useCallback)(async e=>{if(!e)return;c(e),g(null),h(null);let r=u(e);if(!r)return void g("QR code does not contain valid receipt data. Required: t, s, fn, i, fp, n");try{await s.db.addReceipt(r),h("Receipt and transaction added successfully!"),setTimeout(()=>h(null),i.Ez)}catch(e){e instanceof Error&&e.message.includes("already exists")?g(e.message):g("Failed to add receipt to database")}},[u]),y=(0,d.useCallback)(e=>{g("Failed to scan QR code. Please try again.")},[]);return(0,t.jsxs)("div",{className:"max-w-2xl mx-auto p-6 space-y-6",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-center text-gray-900 dark:text-white",children:"QR Receipt Scanner"}),o&&(0,t.jsx)("div",{className:"bg-red-100 dark:bg-red-900/20 border border-red-400 dark:border-red-800 text-red-700 dark:text-red-400 px-4 py-3 rounded",children:o}),x&&(0,t.jsx)("div",{className:"bg-green-100 dark:bg-green-900/20 border border-green-400 dark:border-green-800 text-green-700 dark:text-green-400 px-4 py-3 rounded",children:x}),(0,t.jsx)("div",{className:"flex justify-center space-x-4 mb-4",children:(0,t.jsx)("button",{onClick:()=>r(e=>!e),className:"px-6 py-3 rounded-lg font-semibold transition-colors duration-200 ".concat(e?"bg-red-600 dark:bg-red-500 text-white hover:bg-red-700 dark:hover:bg-red-600":"bg-blue-600 dark:bg-blue-500 text-white hover:bg-blue-700 dark:hover:bg-blue-600"),children:e?"Stop Scanning":"Start Camera Scanner"})}),e&&(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg dark:shadow-gray-900/50",children:[(0,t.jsx)("div",{className:"text-center mb-4",children:(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Position the QR code within the scanner"})}),(0,t.jsx)("div",{className:"w-full max-w-md mx-auto",style:{width:"100%"},children:(0,t.jsx)(n.Lp,{onScan:e=>{e&&e.length>0&&e[0].rawValue&&m(e[0].rawValue)},onError:y,constraints:{facingMode:"environment"}})})]}),a&&(0,t.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[(0,t.jsx)("h3",{className:"font-semibold mb-2 text-gray-900 dark:text-white",children:"Last Processed:"}),(0,t.jsx)("div",{className:"bg-white dark:bg-gray-800 p-3 rounded border border-gray-200 dark:border-gray-600 font-mono text-sm break-all text-gray-900 dark:text-white",children:a})]}),(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow dark:shadow-gray-900/50",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Recent Receipts"}),b&&b.length>0?(0,t.jsx)("div",{className:"space-y-3",children:b.map(e=>(0,t.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded p-3 bg-gray-50 dark:bg-gray-700",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm text-gray-700 dark:text-gray-300",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Timestamp:"})," ",e.t]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Sum:"})," ",e.s]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Fiscal Number:"})," ",e.fn]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Receipt Number:"})," ",e.i]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Fiscal Sign:"})," ",e.fp]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Type:"})," ",e.n]})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["Added: ",e.createdAt?new Date(e.createdAt).toLocaleString():"Unknown"]})]},e.id))}):(0,t.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:"No receipts scanned yet"})]}),(0,t.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,t.jsx)("h3",{className:"font-semibold mb-2 text-gray-900 dark:text-white",children:"How to use:"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-sm text-gray-700 dark:text-gray-300",children:[(0,t.jsx)("li",{children:'Click "Start Camera Scanner" to activate the camera'}),(0,t.jsx)("li",{children:"Position the QR code within the scanner view"}),(0,t.jsx)("li",{children:"The scanner will automatically detect and parse receipt data"}),(0,t.jsx)("li",{children:"Valid receipts will be automatically added to the database"}),(0,t.jsx)("li",{children:"Recent receipts are shown below"})]})]})]})}function o(){let[e,r]=(0,d.useState)("scanner"),[a,n]=(0,d.useState)({t:"",s:"",fn:"",i:"",fp:"",n:"",transactionId:0}),[o,g]=(0,d.useState)(null),[x,h]=(0,d.useState)(null),b=(0,l.kk)(()=>s.db.receipts.orderBy("createdAt").reverse().limit(5).toArray(),[],[]);async function u(e){if(e.preventDefault(),a.t&&a.s&&a.fn&&a.i&&a.fp&&a.n)try{await s.db.addReceipt(a),n({t:"",s:"",fn:"",i:"",fp:"",n:"",transactionId:0}),h("Receipt and transaction added successfully!"),setTimeout(()=>h(null),i.Ez)}catch(e){console.error("Error adding receipt:",e),e instanceof Error&&e.message.includes("already exists")?g(e.message):g("Failed to add receipt")}}return(0,t.jsxs)("div",{className:i.Z,children:[(0,t.jsx)("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-40 md:top-16",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto px-6 py-4",children:(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsxs)("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-full p-1 flex",children:[(0,t.jsx)("button",{onClick:()=>r("scanner"),className:"px-6 py-2 rounded-full text-sm font-medium transition-all duration-200 ".concat("scanner"===e?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100"),children:"QR Scanner"}),(0,t.jsx)("button",{onClick:()=>r("manual"),className:"px-6 py-2 rounded-full text-sm font-medium transition-all duration-200 ".concat("manual"===e?"bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100"),children:"Manual Entry"})]})})})}),"scanner"===e&&(0,t.jsx)(c,{}),"manual"===e&&(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-900/50",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold p-6 border-b border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white",children:"Manual Receipt Entry"}),o&&(0,t.jsx)("div",{className:"mx-6 mt-6 bg-red-100 dark:bg-red-900/20 border border-red-400 dark:border-red-800 text-red-700 dark:text-red-400 px-4 py-3 rounded",children:o}),x&&(0,t.jsx)("div",{className:"mx-6 mt-6 bg-green-100 dark:bg-green-900/20 border border-green-400 dark:border-green-800 text-green-700 dark:text-green-400 px-4 py-3 rounded",children:x}),(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)("form",{onSubmit:u,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Timestamp (t)"}),(0,t.jsx)("input",{type:"text",placeholder:"20231201T120000",value:a.t,onChange:e=>n({...a,t:e.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Sum (s)"}),(0,t.jsx)("input",{type:"text",placeholder:"100.00",value:a.s,onChange:e=>n({...a,s:e.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Fiscal Number (fn)"}),(0,t.jsx)("input",{type:"text",placeholder:"1234567890",value:a.fn,onChange:e=>n({...a,fn:e.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Receipt Number (i)"}),(0,t.jsx)("input",{type:"text",placeholder:"12345",value:a.i,onChange:e=>n({...a,i:e.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Fiscal Sign (fp)"}),(0,t.jsx)("input",{type:"text",placeholder:"67890",value:a.fp,onChange:e=>n({...a,fp:e.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Receipt Type (n)"}),(0,t.jsx)("input",{type:"text",placeholder:"1",value:a.n,onChange:e=>n({...a,n:e.target.value}),className:"w-full border border-gray-300 dark:border-gray-600 rounded px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent",required:!0})]})]}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("button",{type:"submit",className:"bg-orange-600 dark:bg-orange-500 text-white px-8 py-3 rounded-lg hover:bg-orange-700 dark:hover:bg-orange-600 font-medium transition-colors duration-200",children:"Add Receipt"})})]})})]}),(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-900/50",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold p-6 border-b border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white",children:"Recent Receipts"}),b&&b.length>0?(0,t.jsx)("div",{className:"p-6 space-y-4",children:b.map(e=>(0,t.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-700",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm text-gray-700 dark:text-gray-300",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Timestamp:"})," ",e.t]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Sum:"})," ",e.s]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Fiscal Number:"})," ",e.fn]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Receipt Number:"})," ",e.i]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Fiscal Sign:"})," ",e.fp]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"Type:"})," ",e.n]})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-3",children:["Added: ",e.createdAt?new Date(e.createdAt).toLocaleString():"Unknown"]})]},e.id))}):(0,t.jsx)("div",{className:"p-6 text-center text-gray-500 dark:text-gray-400",children:"No receipts found. Scan a QR code or add one manually above."})]}),(0,t.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-6 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,t.jsx)("h3",{className:"font-semibold mb-3 text-gray-900 dark:text-white",children:"How to use Manual Entry:"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-1 text-sm text-gray-700 dark:text-gray-300",children:[(0,t.jsx)("li",{children:"Fill in all the required receipt fields above"}),(0,t.jsx)("li",{children:"Use the format shown in the placeholders"}),(0,t.jsx)("li",{children:'Click "Add Receipt" to save to your database'}),(0,t.jsx)("li",{children:"Recent receipts will appear below"})]}),(0,t.jsxs)("div",{className:"mt-4 p-3 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm mb-2 text-gray-900 dark:text-white",children:"Example Receipt Data:"}),(0,t.jsxs)("div",{className:"text-xs space-y-1 text-gray-700 dark:text-gray-300",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"t:"})," 20231201T120000"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"s:"})," 100.00"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"fn:"})," 1234567890"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"i:"})," 12345"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"fp:"})," 67890"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("strong",{children:"n:"})," 1"]})]})]})]})]})]})}},7299:(e,r,a)=>{Promise.resolve().then(a.bind(a,1913))}},e=>{var r=r=>e(e.s=r);e.O(0,[271,324,151,788,97,358],()=>r(7299)),_N_E=e.O()}]);